---
layout: post
title: [NOIP2013]货车运输
comments: true
---

# [NOIP2013]货车运输
----------
题目链接：[CodeVS 3287][1]

题意：给出一张无向图，每条边有一个边权，图上可以有重边，没有自环。求这张图上两点u,v之间所有路径上最小权值的最大值。若不能互相到达输出-1。
## 1.审题
 1. 显然，无向图不一定是连通图，于是两点之间若要互相到达，必须在同一连通子图上。
 2. 最小权值的最大值：图上u,v两点间有着多条路径，需要找到一条路径，这条路径上所求的权值最小的边最大。

## 2.思路分析

> 对于 30%的数据，0 < n < 1,000，0 < m < 10,000，0 < q < 1,000；
> 对于 60%的数据，0 < n< 1,000，0 < m < 50,000，0 < q < 1,000；
> 对于 100%的数据，0 < n < 10,000，0 < m < 50,000，0 < q < 30,000，0 ≤ z ≤ 100,000。

 -  暴力DFS穷举u,v连通性以及所有路径上每一条边？
    最坏时间复杂度为$O((n+m)q)$ → 30pts (如果时间复杂度算错了，请回复指教，谢谢 =.=）
 -  尝试把问题转换为以某一种次序加入边；加入了某一条边之后，所查询的两点由不连通变为连通。
    以什么顺序加入呢？考虑常见的升序/降序两种选项。
    要满足“最小权值的最大值”，就要满足加入的边权值小于所有已加边，而且加入的边权值在满足题意的基础上尽可能大，也就是说选择降序排序。
    ![MaxST](https://panda2134.github.io/img/VanTrans01.png)
    如上图。对于某一个询问，逐一加入图中每一条边，用并查集维护连通性。
    若某条边连接前，$u$与$v$分属不同集合，连接后，所查询的两点并入了同一个集合，那么原来$u$,$v$所在的子图就连通了。须证明这条边为可行的权值最大的最小边。
    这条边连接两个子图，即这条边为桥，那么边$(u,v)$必然在$u$到$v$的路径上；
    这条边权值小于所有已加边，于是必为路径上最小边；
    若答案的权值大于这条边，由于答案能连通两个子图，且按照降序，在选择它之前答案已经选择，那么两个子图就已经被已经加入的答案边（图中的蓝色边之一）连通了，与题设“此边连接前，$u$与$v$分属不同集合”矛盾。
    综上，这样的一条边必为答案。
    时间复杂度为$O(mq)$→60pts
 -  遇到图上查询，要考虑到转为某种生成树进行处理
    转化成什么生成树呢？
    其实从60分解法中我们可以猜测，应该转为最大生成树。
    60分解法中，完全可以加入添加边时的判断，只有这条边所连的两点分属不同集合，才予以链接，也就是采用类似Kruskal算法的策略，不加入两个端点属于同一个集合的边。e.g.图中最左侧的蓝色边。这样并没有改变原图的连通性，也不影响“加边后由不连通变为连通”的情况。显然，60分解法中的证明过程仍然成立，也就是说，答案在求出的最大生成树上。
    注意，此图不一定为连通图！于是构造出的实际上是最大生成森林。对森林中每棵最大生成树，进行倍增LCA的处理，或者使用树链剖分，即可快速求出树上路径上的最小权值。
    时间复杂度为$O((m+n+q)\log(n))$→100pts

## 3.60分实现
有两种实现方式

 1. 每建一条边，就把所有的查询都走一遍，如果符合题意就记录答案。
 2. 针对每个查询，逐一建边，然后清空已建的边，再进行下个查询。

显然，2中清空并查集的操作，对于每次查询都需进行，复杂度太高，于是应该采用1。

## 4.100分实现
To Be Done
Kruskal不打常数优化！！！

[1]: http://codevs.cn/problem/3287/
